---

title: DataLoader Errors


keywords: fastai
sidebar: home_sidebar

summary: "Errors and exceptions for any step of the `DataLoader` process"
description: "Errors and exceptions for any step of the `DataLoader` process"
nb_path: "01_fastai.dataloader.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 01_fastai.dataloader.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/mnt/d/lib/python3.7/site-packages/torch/cuda/__init__.py:52: UserWarning: CUDA initialization: Found no NVIDIA driver on your system. Please check that you have an NVIDIA GPU and installed a driver from http://www.nvidia.com/Download/index.aspx (Triggered internally at  /pytorch/c10/cuda/CUDAFunctions.cpp:100.)
  return torch._C._cuda_getDeviceCount() &gt; 0
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This includes <code>after_item</code>, <code>after_batch</code>, and collating. Anything in relation to the <code>Datasets</code> or anything before the <code>DataLoader</code> process can be found in <code>fastdebug.fastai.dataset</code></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="collate_error" class="doc_header"><code>collate_error</code><a href="https://github.com/muellerzr/fastdebug/tree/master/fastdebug/fastai/dataloader.py#L12" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>collate_error</code>(<strong><code>e</code></strong>:<code>Exception</code>, <strong><code>batch</code></strong>)</p>
</blockquote>
<p>Raises an explicit error when the batch could not collate, stating
 what items in the batch are different sizes and their types</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="DataLoader.create_batch" class="doc_header"><code>DataLoader.create_batch</code><a href="https://github.com/muellerzr/fastdebug/tree/master/fastdebug/fastai/dataloader.py#L38" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>DataLoader.create_batch</code>(<strong><code>b</code></strong>)</p>
</blockquote>
<p>Collate a list of items into a batch.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/fastdebug/fastai.dataloader.html#collate_error"><code>collate_error</code></a> is <code>@patch</code>'d into <code>DataLoader</code>'s <code>create_batch</code> function through importing this module, so if there is any possible reason why the data cannot be collated into the batch, it is presented to the user.</p>
<p>An example is below, where we forgot to include an item transform that resizes all our images to the same size:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">fastai.vision.all</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">untar_data</span><span class="p">(</span><span class="n">URLs</span><span class="o">.</span><span class="n">PETS</span><span class="p">)</span><span class="o">/</span><span class="s1">&#39;images&#39;</span>
<span class="n">dls</span> <span class="o">=</span> <span class="n">ImageDataLoaders</span><span class="o">.</span><span class="n">from_name_func</span><span class="p">(</span>
    <span class="n">path</span><span class="p">,</span> <span class="n">get_image_files</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="n">valid_pct</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">label_func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isupper</span><span class="p">())</span>

<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">dls</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">one_batch</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">RuntimeError</span>                              Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-8-c493bee87237&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span>     label_func=lambda x: x[0].isupper())
<span class="ansi-green-intense-fg ansi-bold">      7</span> 
<span class="ansi-green-fg">----&gt; 8</span><span class="ansi-red-fg"> </span>x<span class="ansi-blue-fg">,</span>y <span class="ansi-blue-fg">=</span> dls<span class="ansi-blue-fg">.</span>train<span class="ansi-blue-fg">.</span>one_batch<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/usr/local/lib/python3.7/dist-packages/fastai/data/load.py</span> in <span class="ansi-cyan-fg">one_batch</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    148</span>     <span class="ansi-green-fg">def</span> one_batch<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    149</span>         <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>n <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span> <span class="ansi-green-fg">and</span> len<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">==</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">raise</span> ValueError<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">f&#39;This DataLoader does not contain any batches&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 150</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">with</span> self<span class="ansi-blue-fg">.</span>fake_l<span class="ansi-blue-fg">.</span>no_multiproc<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> res <span class="ansi-blue-fg">=</span> first<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    151</span>         <span class="ansi-green-fg">if</span> hasattr<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;it&#39;</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> delattr<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;it&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    152</span>         <span class="ansi-green-fg">return</span> res

<span class="ansi-green-fg">/usr/local/lib/python3.7/dist-packages/fastcore/basics.py</span> in <span class="ansi-cyan-fg">first</span><span class="ansi-blue-fg">(x, f, negate, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    545</span>     x <span class="ansi-blue-fg">=</span> iter<span class="ansi-blue-fg">(</span>x<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    546</span>     <span class="ansi-green-fg">if</span> f<span class="ansi-blue-fg">:</span> x <span class="ansi-blue-fg">=</span> filter_ex<span class="ansi-blue-fg">(</span>x<span class="ansi-blue-fg">,</span> f<span class="ansi-blue-fg">=</span>f<span class="ansi-blue-fg">,</span> negate<span class="ansi-blue-fg">=</span>negate<span class="ansi-blue-fg">,</span> gen<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">True</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 547</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">return</span> next<span class="ansi-blue-fg">(</span>x<span class="ansi-blue-fg">,</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    548</span> 
<span class="ansi-green-intense-fg ansi-bold">    549</span> <span class="ansi-red-fg"># Cell</span>

<span class="ansi-green-fg">/usr/local/lib/python3.7/dist-packages/fastai/data/load.py</span> in <span class="ansi-cyan-fg">__iter__</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    107</span>         self<span class="ansi-blue-fg">.</span>before_iter<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    108</span>         self<span class="ansi-blue-fg">.</span>__idxs<span class="ansi-blue-fg">=</span>self<span class="ansi-blue-fg">.</span>get_idxs<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span> <span class="ansi-red-fg"># called in context of main process (not workers/subprocesses)</span>
<span class="ansi-green-fg">--&gt; 109</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">for</span> b <span class="ansi-green-fg">in</span> _loaders<span class="ansi-blue-fg">[</span>self<span class="ansi-blue-fg">.</span>fake_l<span class="ansi-blue-fg">.</span>num_workers<span class="ansi-blue-fg">==</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>fake_l<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    110</span>             <span class="ansi-red-fg"># fix issue 2899. If the process start method isn&#39;t fork, the data will be copied to cuda in learner one_batch.</span>
<span class="ansi-green-intense-fg ansi-bold">    111</span>             <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>device <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span> <span class="ansi-green-fg">and</span> multiprocessing<span class="ansi-blue-fg">.</span>get_start_method<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>lower<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">==</span> <span class="ansi-blue-fg">&#34;fork&#34;</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/usr/local/lib/python3.7/dist-packages/torch/utils/data/dataloader.py</span> in <span class="ansi-cyan-fg">__next__</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    433</span>         <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>_sampler_iter <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    434</span>             self<span class="ansi-blue-fg">.</span>_reset<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 435</span><span class="ansi-red-fg">         </span>data <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_next_data<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    436</span>         self<span class="ansi-blue-fg">.</span>_num_yielded <span class="ansi-blue-fg">+=</span> <span class="ansi-cyan-fg">1</span>
<span class="ansi-green-intense-fg ansi-bold">    437</span>         <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>_dataset_kind <span class="ansi-blue-fg">==</span> _DatasetKind<span class="ansi-blue-fg">.</span>Iterable <span class="ansi-green-fg">and</span><span class="ansi-red-fg"> </span><span class="ansi-red-fg">\</span>

<span class="ansi-green-fg">/usr/local/lib/python3.7/dist-packages/torch/utils/data/dataloader.py</span> in <span class="ansi-cyan-fg">_next_data</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    473</span>     <span class="ansi-green-fg">def</span> _next_data<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    474</span>         index <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_next_index<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>  <span class="ansi-red-fg"># may raise StopIteration</span>
<span class="ansi-green-fg">--&gt; 475</span><span class="ansi-red-fg">         </span>data <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_dataset_fetcher<span class="ansi-blue-fg">.</span>fetch<span class="ansi-blue-fg">(</span>index<span class="ansi-blue-fg">)</span>  <span class="ansi-red-fg"># may raise StopIteration</span>
<span class="ansi-green-intense-fg ansi-bold">    476</span>         <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>_pin_memory<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    477</span>             data <span class="ansi-blue-fg">=</span> _utils<span class="ansi-blue-fg">.</span>pin_memory<span class="ansi-blue-fg">.</span>pin_memory<span class="ansi-blue-fg">(</span>data<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/usr/local/lib/python3.7/dist-packages/torch/utils/data/_utils/fetch.py</span> in <span class="ansi-cyan-fg">fetch</span><span class="ansi-blue-fg">(self, possibly_batched_index)</span>
<span class="ansi-green-intense-fg ansi-bold">     32</span>                 <span class="ansi-green-fg">raise</span> StopIteration
<span class="ansi-green-intense-fg ansi-bold">     33</span>         <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 34</span><span class="ansi-red-fg">             </span>data <span class="ansi-blue-fg">=</span> next<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>dataset_iter<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     35</span>         <span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>collate_fn<span class="ansi-blue-fg">(</span>data<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     36</span> 

<span class="ansi-green-fg">/usr/local/lib/python3.7/dist-packages/fastai/data/load.py</span> in <span class="ansi-cyan-fg">create_batches</span><span class="ansi-blue-fg">(self, samps)</span>
<span class="ansi-green-intense-fg ansi-bold">    118</span>         <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>dataset <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span> self<span class="ansi-blue-fg">.</span>it <span class="ansi-blue-fg">=</span> iter<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>dataset<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    119</span>         res <span class="ansi-blue-fg">=</span> filter<span class="ansi-blue-fg">(</span><span class="ansi-green-fg">lambda</span> o<span class="ansi-blue-fg">:</span>o <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> map<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>do_item<span class="ansi-blue-fg">,</span> samps<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 120</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">yield</span> <span class="ansi-green-fg">from</span> map<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>do_batch<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>chunkify<span class="ansi-blue-fg">(</span>res<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    121</span> 
<span class="ansi-green-intense-fg ansi-bold">    122</span>     <span class="ansi-green-fg">def</span> new<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> dataset<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> cls<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/usr/local/lib/python3.7/dist-packages/fastai/data/load.py</span> in <span class="ansi-cyan-fg">do_batch</span><span class="ansi-blue-fg">(self, b)</span>
<span class="ansi-green-intense-fg ansi-bold">    144</span>         <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">raise</span> IndexError<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;Cannot index an iterable dataset numerically - must use `None`.&#34;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    145</span>     <span class="ansi-green-fg">def</span> create_batch<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> b<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> <span class="ansi-blue-fg">(</span>fa_collate<span class="ansi-blue-fg">,</span>fa_convert<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">[</span>self<span class="ansi-blue-fg">.</span>prebatched<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 146</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">def</span> do_batch<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> b<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>retain<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>create_batch<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>before_batch<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> b<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    147</span>     <span class="ansi-green-fg">def</span> to<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> device<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> self<span class="ansi-blue-fg">.</span>device <span class="ansi-blue-fg">=</span> device
<span class="ansi-green-intense-fg ansi-bold">    148</span>     <span class="ansi-green-fg">def</span> one_batch<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">&lt;ipython-input-7-a9809be51294&gt;</span> in <span class="ansi-cyan-fg">create_batch</span><span class="ansi-blue-fg">(self, b)</span>
<span class="ansi-green-intense-fg ansi-bold">      8</span>     <span class="ansi-green-fg">except</span> Exception <span class="ansi-green-fg">as</span> e<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">      9</span>         <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> self<span class="ansi-blue-fg">.</span>prebatched<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 10</span><span class="ansi-red-fg">             </span>collate_error<span class="ansi-blue-fg">(</span>e<span class="ansi-blue-fg">,</span> b<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     11</span>         <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">raise</span> e

<span class="ansi-green-fg">&lt;ipython-input-6-f0b390dbe89c&gt;</span> in <span class="ansi-cyan-fg">collate_error</span><span class="ansi-blue-fg">(e, batch)</span>
<span class="ansi-green-intense-fg ansi-bold">     23</span>                     err <span class="ansi-blue-fg">+=</span> <span class="ansi-blue-fg">f&#39;Please include a transform in `after_item` that ensures all data of type {type_a} is the same size&#39;</span>
<span class="ansi-green-intense-fg ansi-bold">     24</span>                     e<span class="ansi-blue-fg">.</span>args <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">[</span>err<span class="ansi-blue-fg">]</span>
<span class="ansi-green-fg">---&gt; 25</span><span class="ansi-red-fg">                     </span><span class="ansi-green-fg">raise</span> e

<span class="ansi-green-fg">&lt;ipython-input-7-a9809be51294&gt;</span> in <span class="ansi-cyan-fg">create_batch</span><span class="ansi-blue-fg">(self, b)</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span>     func <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">(</span>fa_collate<span class="ansi-blue-fg">,</span>fa_convert<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">[</span>self<span class="ansi-blue-fg">.</span>prebatched<span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span>     <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 7</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> func<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      8</span>     <span class="ansi-green-fg">except</span> Exception <span class="ansi-green-fg">as</span> e<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">      9</span>         <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> self<span class="ansi-blue-fg">.</span>prebatched<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/usr/local/lib/python3.7/dist-packages/fastai/data/load.py</span> in <span class="ansi-cyan-fg">fa_collate</span><span class="ansi-blue-fg">(t)</span>
<span class="ansi-green-intense-fg ansi-bold">     48</span>     b <span class="ansi-blue-fg">=</span> t<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">     49</span>     return (default_collate(t) if isinstance(b, _collate_types)
<span class="ansi-green-fg">---&gt; 50</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">else</span> type<span class="ansi-blue-fg">(</span>t<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">[</span>fa_collate<span class="ansi-blue-fg">(</span>s<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">for</span> s <span class="ansi-green-fg">in</span> zip<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>t<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">if</span> isinstance<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">,</span> Sequence<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     51</span>             else default_collate(t))
<span class="ansi-green-intense-fg ansi-bold">     52</span> 

<span class="ansi-green-fg">/usr/local/lib/python3.7/dist-packages/fastai/data/load.py</span> in <span class="ansi-cyan-fg">&lt;listcomp&gt;</span><span class="ansi-blue-fg">(.0)</span>
<span class="ansi-green-intense-fg ansi-bold">     48</span>     b <span class="ansi-blue-fg">=</span> t<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">     49</span>     return (default_collate(t) if isinstance(b, _collate_types)
<span class="ansi-green-fg">---&gt; 50</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">else</span> type<span class="ansi-blue-fg">(</span>t<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">[</span>fa_collate<span class="ansi-blue-fg">(</span>s<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">for</span> s <span class="ansi-green-fg">in</span> zip<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>t<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">if</span> isinstance<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">,</span> Sequence<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     51</span>             else default_collate(t))
<span class="ansi-green-intense-fg ansi-bold">     52</span> 

<span class="ansi-green-fg">/usr/local/lib/python3.7/dist-packages/fastai/data/load.py</span> in <span class="ansi-cyan-fg">fa_collate</span><span class="ansi-blue-fg">(t)</span>
<span class="ansi-green-intense-fg ansi-bold">     47</span>     <span class="ansi-blue-fg">&#34;A replacement for PyTorch `default_collate` which maintains types and handles `Sequence`s&#34;</span>
<span class="ansi-green-intense-fg ansi-bold">     48</span>     b <span class="ansi-blue-fg">=</span> t<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-fg">---&gt; 49</span><span class="ansi-red-fg">     return (default_collate(t) if isinstance(b, _collate_types)
</span><span class="ansi-green-intense-fg ansi-bold">     50</span>             <span class="ansi-green-fg">else</span> type<span class="ansi-blue-fg">(</span>t<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">[</span>fa_collate<span class="ansi-blue-fg">(</span>s<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">for</span> s <span class="ansi-green-fg">in</span> zip<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>t<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">if</span> isinstance<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">,</span> Sequence<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     51</span>             else default_collate(t))

<span class="ansi-green-fg">/usr/local/lib/python3.7/dist-packages/torch/utils/data/_utils/collate.py</span> in <span class="ansi-cyan-fg">default_collate</span><span class="ansi-blue-fg">(batch)</span>
<span class="ansi-green-intense-fg ansi-bold">     53</span>             storage <span class="ansi-blue-fg">=</span> elem<span class="ansi-blue-fg">.</span>storage<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>_new_shared<span class="ansi-blue-fg">(</span>numel<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     54</span>             out <span class="ansi-blue-fg">=</span> elem<span class="ansi-blue-fg">.</span>new<span class="ansi-blue-fg">(</span>storage<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">---&gt; 55</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> torch<span class="ansi-blue-fg">.</span>stack<span class="ansi-blue-fg">(</span>batch<span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">,</span> out<span class="ansi-blue-fg">=</span>out<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     56</span>     <span class="ansi-green-fg">elif</span> elem_type<span class="ansi-blue-fg">.</span>__module__ <span class="ansi-blue-fg">==</span> <span class="ansi-blue-fg">&#39;numpy&#39;</span> <span class="ansi-green-fg">and</span> elem_type<span class="ansi-blue-fg">.</span>__name__ <span class="ansi-blue-fg">!=</span> <span class="ansi-blue-fg">&#39;str_&#39;</span><span class="ansi-red-fg"> </span><span class="ansi-red-fg">\</span>
<span class="ansi-green-intense-fg ansi-bold">     57</span>             <span class="ansi-green-fg">and</span> elem_type<span class="ansi-blue-fg">.</span>__name__ <span class="ansi-blue-fg">!=</span> <span class="ansi-blue-fg">&#39;string_&#39;</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">/usr/local/lib/python3.7/dist-packages/fastai/torch_core.py</span> in <span class="ansi-cyan-fg">__torch_function__</span><span class="ansi-blue-fg">(self, func, types, args, kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    327</span>         convert<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">False</span>
<span class="ansi-green-intense-fg ansi-bold">    328</span>         <span class="ansi-green-fg">if</span> _torch_handled<span class="ansi-blue-fg">(</span>args<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>_opt<span class="ansi-blue-fg">,</span> func<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> convert<span class="ansi-blue-fg">,</span>types <span class="ansi-blue-fg">=</span> type<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span><span class="ansi-blue-fg">(</span>torch<span class="ansi-blue-fg">.</span>Tensor<span class="ansi-blue-fg">,</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 329</span><span class="ansi-red-fg">         </span>res <span class="ansi-blue-fg">=</span> super<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>__torch_function__<span class="ansi-blue-fg">(</span>func<span class="ansi-blue-fg">,</span> types<span class="ansi-blue-fg">,</span> args<span class="ansi-blue-fg">=</span>args<span class="ansi-blue-fg">,</span> kwargs<span class="ansi-blue-fg">=</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    330</span>         <span class="ansi-green-fg">if</span> convert<span class="ansi-blue-fg">:</span> res <span class="ansi-blue-fg">=</span> convert<span class="ansi-blue-fg">(</span>res<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    331</span>         <span class="ansi-green-fg">if</span> isinstance<span class="ansi-blue-fg">(</span>res<span class="ansi-blue-fg">,</span> TensorBase<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> res<span class="ansi-blue-fg">.</span>set_meta<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> as_copy<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">True</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">/usr/local/lib/python3.7/dist-packages/torch/tensor.py</span> in <span class="ansi-cyan-fg">__torch_function__</span><span class="ansi-blue-fg">(cls, func, types, args, kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    993</span> 
<span class="ansi-green-intense-fg ansi-bold">    994</span>         <span class="ansi-green-fg">with</span> _C<span class="ansi-blue-fg">.</span>DisableTorchFunction<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 995</span><span class="ansi-red-fg">             </span>ret <span class="ansi-blue-fg">=</span> func<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    996</span>             <span class="ansi-green-fg">return</span> _convert<span class="ansi-blue-fg">(</span>ret<span class="ansi-blue-fg">,</span> cls<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    997</span> 

<span class="ansi-red-fg">RuntimeError</span>: Error when trying to collate the data into batches with fa_collate, at least two tensors in the batch are not the same size.

Mismatch found within the 0th axis of the batch and is of type TensorImage:
The first item has shape: torch.Size([3, 500, 333])
The second item has shape: torch.Size([3, 333, 500])

Please include a transform in `after_item` that ensures all data of type TensorImage is the same size</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="TfmdDL.new" class="doc_header"><code>TfmdDL.new</code><a href="https://github.com/muellerzr/fastdebug/tree/master/fastdebug/fastai/transform.py#L44" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>TfmdDL.new</code>(<strong><code>dataset</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Create a new version of self with a few changed attributes</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

</div>
 

